// ==UserScript==
// @name         BombParty Overlay
// @version      1.1.8
// @description  Overlay + Utilities for BombParty!
// @icon         https://raw.githubusercontent.com/MrInanimated/bp-overlay/master/dist/icon.png
// @icon64       https://raw.githubusercontent.com/MrInanimated/bp-overlay/master/dist/icon64.png
// @downloadURL  https://github.com/MrInanimated/bp-overlay/raw/master/dist/bpoverlay.min.user.js
// @author       Tianlin Zhang
// @match        http://bombparty.sparklinlabs.com/play/*
// @grant        none
// ==/UserScript==

// Un-minified JS, available at https://github.com/MrInanimated/bp-overlay/blob/master/dist/bpoverlay.user.js

GM_xmlhttpRequest({method:"GET",url:"http://twitchemotes.com/global.json",onload:function(e){var t=document.createElement("script");t.setAttribute("type","application/javascript");t.textContent="var twitch_global = "+e.responseText+";";document.body.appendChild(t);document.body.removeChild(t)},onerror:function(e){var t=document.createElement("script");t.setAttribute("type","application/javascript");t.textContent='channel.appendToChat("Info", "Couldn\'t fetch twitch global emotes :(");';document.body.appendChild(t);document.body.removeChild(t)}});GM_xmlhttpRequest({method:"GET",url:"http://twitchemotes.com/subscriber.json",onload:function(e){var t=document.createElement("script");t.setAttribute("type","application/javascript");t.textContent="var twitch_subscriber = "+e.responseText+";";document.body.appendChild(t);document.body.removeChild(t)},onerror:function(e){var t=document.createElement("script");t.setAttribute("type","application/javascript");t.textContent='channel.appendToChat("Info", "Couldn\'t fetch twitch subscriber emotes :(");';document.body.appendChild(t);document.body.removeChild(t)}})
var source=function(){if(window.hasOwnProperty("BPOverlayHasRun")){}else{window.BPOverlayHasRun=true;var e=function(){function n(){var e=window.innerHeight,t=window.innerWidth;var n=document.getElementById("infoBox");var r=n.clientWidth;var i=n.clientHeight;var s=document.getElementById("dragonDrop");var o=parseInt(s.style.left);var u=parseInt(s.style.top);if(r+o>t){s.style.left=t-r+"px"}if(u<0){s.style.top="0px"}else if(i+u>e){s.style.top=e-i+"px"}}function r(e){var t=window.getComputedStyle(e.target,null);e.dataTransfer.setData("text/plain",parseInt(t.getPropertyValue("left"),10)-e.clientX+","+(parseInt(t.getPropertyValue("top"),10)-e.clientY))}function s(e){e.preventDefault();return false}function o(e){var t=e.dataTransfer.getData("text/plain").split(",");var n=document.getElementById("dragonDrop");var r=e.clientX+parseInt(t[0],10);var i=e.clientY+parseInt(t[1],10);var s=window.innerHeight,o=window.innerWidth;var u=document.getElementById("infoBox").clientHeight;var a=document.getElementById("infoBox").clientWidth;if(r<0){n.style.left="0px"}else if(r+a>o){n.style.left=o-a+"px"}else{n.style.left=r+"px"}if(i<0){n.style.top="0px"}else if(i+u>s){n.style.top=s-u+"px"}else{n.style.top=i+"px"}e.preventDefault();return false}if(!(window.hasOwnProperty("channel")&&channel.socket&&channel.data&&channel.appendToChat&&channel.socket.listeners("setActivePlayerIndex").length&&channel.socket.listeners("winWord").length&&channel.socket.listeners("setPlayerLives").length&&channel.socket.listeners("setPlayerState").length&&channel.socket.listeners("endGame").length)){console.log("Everything's not loaded yet, trying again in a second...");setTimeout(e,1e3);return}!function(e,t){"function"==typeof define&&define.amd?define([],function(){return e.returnExportsGlobal=t()}):"object"==typeof exports?module.exports=t():e.Autolinker=t()}(this,function(){var e=function(t){e.Util.assign(this,t),this.matchValidator=new e.MatchValidator};return e.prototype={constructor:e,urls:!0,email:!0,twitter:!0,newWindow:!0,stripPrefix:!0,className:"",htmlCharacterEntitiesRegex:/(&nbsp;|&#160;|&lt;|&#60;|&gt;|&#62;)/gi,matcherRegex:function(){var e=/(^|[^\w])@(\w{1,15})/,t=/(?:[\-;:&=\+\$,\w\.]+@)/,n=/(?:[A-Za-z][-.+A-Za-z0-9]+:(?![A-Za-z][-.+A-Za-z0-9]+:\/\/)(?!\d+\/?)(?:\/\/)?)/,r=/(?:www\.)/,i=/[A-Za-z0-9\.\-]*[A-Za-z0-9\-]/,s=/\.(?:international|construction|contractors|enterprises|photography|productions|foundation|immobilien|industries|management|properties|technology|christmas|community|directory|education|equipment|institute|marketing|solutions|vacations|bargains|boutique|builders|catering|cleaning|clothing|computer|democrat|diamonds|graphics|holdings|lighting|partners|plumbing|supplies|training|ventures|academy|careers|company|cruises|domains|exposed|flights|florist|gallery|guitars|holiday|kitchen|neustar|okinawa|recipes|rentals|reviews|shiksha|singles|support|systems|agency|berlin|camera|center|coffee|condos|dating|estate|events|expert|futbol|kaufen|luxury|maison|monash|museum|nagoya|photos|repair|report|social|supply|tattoo|tienda|travel|viajes|villas|vision|voting|voyage|actor|build|cards|cheap|codes|dance|email|glass|house|mango|ninja|parts|photo|shoes|solar|today|tokyo|tools|watch|works|aero|arpa|asia|best|bike|blue|buzz|camp|club|cool|coop|farm|fish|gift|guru|info|jobs|kiwi|kred|land|limo|link|menu|mobi|moda|name|pics|pink|post|qpon|rich|ruhr|sexy|tips|vote|voto|wang|wien|wiki|zone|bar|bid|biz|cab|cat|ceo|com|edu|gov|int|kim|mil|net|onl|org|pro|pub|red|tel|uno|wed|xxx|xyz|ac|ad|ae|af|ag|ai|al|am|an|ao|aq|ar|as|at|au|aw|ax|az|ba|bb|bd|be|bf|bg|bh|bi|bj|bm|bn|bo|br|bs|bt|bv|bw|by|bz|ca|cc|cd|cf|cg|ch|ci|ck|cl|cm|cn|co|cr|cu|cv|cw|cx|cy|cz|de|dj|dk|dm|do|dz|ec|ee|eg|er|es|et|eu|fi|fj|fk|fm|fo|fr|ga|gb|gd|ge|gf|gg|gh|gi|gl|gm|gn|gp|gq|gr|gs|gt|gu|gw|gy|hk|hm|hn|hr|ht|hu|id|ie|il|im|in|io|iq|ir|is|it|je|jm|jo|jp|ke|kg|kh|ki|km|kn|kp|kr|kw|ky|kz|la|lb|lc|li|lk|lr|ls|lt|lu|lv|ly|ma|mc|md|me|mg|mh|mk|ml|mm|mn|mo|mp|mq|mr|ms|mt|mu|mv|mw|mx|my|mz|na|nc|ne|nf|ng|ni|nl|no|np|nr|nu|nz|om|pa|pe|pf|pg|ph|pk|pl|pm|pn|pr|ps|pt|pw|py|qa|re|ro|rs|ru|rw|sa|sb|sc|sd|se|sg|sh|si|sj|sk|sl|sm|sn|so|sr|st|su|sv|sx|sy|sz|tc|td|tf|tg|th|tj|tk|tl|tm|tn|to|tp|tr|tt|tv|tw|tz|ua|ug|uk|us|uy|uz|va|vc|ve|vg|vi|vn|vu|wf|ws|ye|yt|za|zm|zw)\b/,o=/[\-A-Za-z0-9+&@#\/%=~_()|'$*\[\]?!:,.;]*[\-A-Za-z0-9+&@#\/%=~_()|'$*\[\]]/;return new RegExp(["(",e.source,")","|","(",t.source,i.source,s.source,")","|","(","(?:","(",n.source,i.source,")","|","(?:","(.?//)?",r.source,i.source,")","|","(?:","(.?//)?",i.source,s.source,")",")","(?:"+o.source+")?",")"].join(""),"gi")}(),charBeforeProtocolRelMatchRegex:/^(.)?\/\//,link:function(t){var n=this,r=this.getHtmlParser(),i=this.htmlCharacterEntitiesRegex,s=0,o=[];return r.parse(t,{processHtmlNode:function(e,t,n){"a"===t&&(n?s=Math.max(s-1,0):s++),o.push(e)},processTextNode:function(t){if(0===s)for(var r=e.Util.splitAndCapture(t,i),u=0,a=r.length;a>u;u++){var f=r[u],l=n.processTextNode(f);o.push(l)}else o.push(t)}}),o.join("")},getHtmlParser:function(){var t=this.htmlParser;return t||(t=this.htmlParser=new e.HtmlParser),t},getTagBuilder:function(){var t=this.tagBuilder;return t||(t=this.tagBuilder=new e.AnchorTagBuilder({newWindow:this.newWindow,truncate:this.truncate,className:this.className})),t},processTextNode:function(e){var t=this;return e.replace(this.matcherRegex,function(e,n,r,i,s,o,u,a,f){var l=t.processCandidateMatch(e,n,r,i,s,o,u,a,f);if(l){var c=t.createMatchReturnVal(l.match,l.matchStr);return l.prefixStr+c+l.suffixStr}return e})},processCandidateMatch:function(t,n,r,i,s,o,u,a,f){var l,c=a||f,h="",p="";if(n&&!this.twitter||s&&!this.email||o&&!this.urls||!this.matchValidator.isValidMatch(o,u,c))return null;if(this.matchHasUnbalancedClosingParen(t)&&(t=t.substr(0,t.length-1),p=")"),s)l=new e.match.Email({matchedText:t,email:s});else if(n)r&&(h=r,t=t.slice(1)),l=new e.match.Twitter({matchedText:t,twitterHandle:i});else{if(c){var d=c.match(this.charBeforeProtocolRelMatchRegex)[1]||"";d&&(h=d,t=t.slice(1))}l=new e.match.Url({matchedText:t,url:t,protocolUrlMatch:!!u,protocolRelativeMatch:!!c,stripPrefix:this.stripPrefix})}return{prefixStr:h,suffixStr:p,matchStr:t,match:l}},matchHasUnbalancedClosingParen:function(e){var t=e.charAt(e.length-1);if(")"===t){var n=e.match(/\(/g),r=e.match(/\)/g),i=n&&n.length||0,s=r&&r.length||0;if(s>i)return!0}return!1},createMatchReturnVal:function(t,n){var r;if(this.replaceFn&&(r=this.replaceFn.call(this,this,t)),"string"==typeof r)return r;if(r===!1)return n;if(r instanceof e.HtmlTag)return r.toString();var i=this.getTagBuilder(),s=i.build(t);return s.toString()}},e.link=function(t,n){var r=new e(n);return r.link(t)},e.match={},e.Util={abstractMethod:function(){throw"abstract"},assign:function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);return e},extend:function(t,n){var r=t.prototype,i=function(){};i.prototype=r;var s;s=n.hasOwnProperty("constructor")?n.constructor:function(){r.constructor.apply(this,arguments)};var o=s.prototype=new i;return o.constructor=s,o.superclass=r,delete n.constructor,e.Util.assign(o,n),s},ellipsis:function(e,t,n){return e.length>t&&(n=null==n?"..":n,e=e.substring(0,t-n.length)+n),e},indexOf:function(e,t){if(Array.prototype.indexOf)return e.indexOf(t);for(var n=0,r=e.length;r>n;n++)if(e[n]===t)return n;return-1},splitAndCapture:function(e,t){if(!t.global)throw new Error("`splitRegex` must have the 'g' flag set");for(var n,r=[],i=0;n=t.exec(e);)r.push(e.substring(i,n.index)),r.push(n[0]),i=n.index+n[0].length;return r.push(e.substring(i)),r}},e.HtmlParser=e.Util.extend(Object,{htmlRegex:function(){var e=/[0-9a-zA-Z][0-9a-zA-Z:]*/,t=/[^\s\0"'>\/=\x01-\x1F\x7F]+/,n=/(?:".*?"|'.*?'|[^'"=<>`\s]+)/,r=t.source+"(?:\\s*=\\s*"+n.source+")?";return new RegExp(["(?:","<(!DOCTYPE)","(?:","\\s+","(?:",r,"|",n.source+")",")*",">",")","|","(?:","<(/)?","("+e.source+")","(?:","\\s+",r,")*","\\s*/?",">",")"].join(""),"gi")}(),parse:function(e,t){t=t||{};for(var n,r=t.processHtmlNode||function(){},i=t.processTextNode||function(){},s=this.htmlRegex,o=0;null!==(n=s.exec(e));){var u=n[0],a=n[1]||n[3],f=!!n[2],l=e.substring(o,n.index);l&&i(l),r(u,a.toLowerCase(),f),o=n.index+u.length}if(o<e.length){var c=e.substring(o);c&&i(c)}}}),e.HtmlTag=e.Util.extend(Object,{whitespaceRegex:/\s+/,constructor:function(t){e.Util.assign(this,t),this.innerHtml=this.innerHtml||this.innerHTML},setTagName:function(e){return this.tagName=e,this},getTagName:function(){return this.tagName||""},setAttr:function(e,t){var n=this.getAttrs();return n[e]=t,this},getAttr:function(e){return this.getAttrs()[e]},setAttrs:function(t){var n=this.getAttrs();return e.Util.assign(n,t),this},getAttrs:function(){return this.attrs||(this.attrs={})},setClass:function(e){return this.setAttr("class",e)},addClass:function(t){for(var n,r=this.getClass(),i=this.whitespaceRegex,s=e.Util.indexOf,o=r?r.split(i):[],u=t.split(i);n=u.shift();)-1===s(o,n)&&o.push(n);return this.getAttrs()["class"]=o.join(" "),this},removeClass:function(t){for(var n,r=this.getClass(),i=this.whitespaceRegex,s=e.Util.indexOf,o=r?r.split(i):[],u=t.split(i);o.length&&(n=u.shift());){var a=s(o,n);-1!==a&&o.splice(a,1)}return this.getAttrs()["class"]=o.join(" "),this},getClass:function(){return this.getAttrs()["class"]||""},hasClass:function(e){return-1!==(" "+this.getClass()+" ").indexOf(" "+e+" ")},setInnerHtml:function(e){return this.innerHtml=e,this},getInnerHtml:function(){return this.innerHtml||""},toString:function(){var e=this.getTagName(),t=this.buildAttrsStr();return t=t?" "+t:"",["<",e,t,">",this.getInnerHtml(),"</",e,">"].join("")},buildAttrsStr:function(){if(!this.attrs)return"";var e=this.getAttrs(),t=[];for(var n in e)e.hasOwnProperty(n)&&t.push(n+'="'+e[n]+'"');return t.join(" ")}}),e.MatchValidator=e.Util.extend(Object,{invalidProtocolRelMatchRegex:/^[\w]\/\//,hasFullProtocolRegex:/^[A-Za-z][-.+A-Za-z0-9]+:\/\//,uriSchemeRegex:/^[A-Za-z][-.+A-Za-z0-9]+:/,hasWordCharAfterProtocolRegex:/:[^\s]*?[A-Za-z]/,isValidMatch:function(e,t,n){return t&&!this.isValidUriScheme(t)||this.urlMatchDoesNotHaveProtocolOrDot(e,t)||this.urlMatchDoesNotHaveAtLeastOneWordChar(e,t)||this.isInvalidProtocolRelativeMatch(n)?!1:!0},isValidUriScheme:function(e){var t=e.match(this.uriSchemeRegex)[0];return"javascript:"!==t&&"vbscript:"!==t},urlMatchDoesNotHaveProtocolOrDot:function(e,t){return!(!e||t&&this.hasFullProtocolRegex.test(t)||-1!==e.indexOf("."))},urlMatchDoesNotHaveAtLeastOneWordChar:function(e,t){return e&&t?!this.hasWordCharAfterProtocolRegex.test(e):!1},isInvalidProtocolRelativeMatch:function(e){return!!e&&this.invalidProtocolRelMatchRegex.test(e)}}),e.AnchorTagBuilder=e.Util.extend(Object,{constructor:function(t){e.Util.assign(this,t)},build:function(t){var n=new e.HtmlTag({tagName:"a",attrs:this.createAttrs(t.getType(),t.getAnchorHref()),innerHtml:this.processAnchorText(t.getAnchorText())});return n},createAttrs:function(e,t){var n={href:t},r=this.createCssClass(e);return r&&(n["class"]=r),this.newWindow&&(n.target="_blank"),n},createCssClass:function(e){var t=this.className;return t?t+" "+t+"-"+e:""},processAnchorText:function(e){return e=this.doTruncate(e)},doTruncate:function(t){return e.Util.ellipsis(t,this.truncate||Number.POSITIVE_INFINITY)}}),e.match.Match=e.Util.extend(Object,{constructor:function(t){e.Util.assign(this,t)},getType:e.Util.abstractMethod,getMatchedText:function(){return this.matchedText},getAnchorHref:e.Util.abstractMethod,getAnchorText:e.Util.abstractMethod}),e.match.Email=e.Util.extend(e.match.Match,{getType:function(){return"email"},getEmail:function(){return this.email},getAnchorHref:function(){return"mailto:"+this.email},getAnchorText:function(){return this.email}}),e.match.Twitter=e.Util.extend(e.match.Match,{getType:function(){return"twitter"},getTwitterHandle:function(){return this.twitterHandle},getAnchorHref:function(){return"https://twitter.com/"+this.twitterHandle},getAnchorText:function(){return"@"+this.twitterHandle}}),e.match.Url=e.Util.extend(e.match.Match,{urlPrefixRegex:/^(https?:\/\/)?(www\.)?/i,protocolRelativeRegex:/^\/\//,protocolPrepended:!1,getType:function(){return"url"},getUrl:function(){var e=this.url;return this.protocolRelativeMatch||this.protocolUrlMatch||this.protocolPrepended||(e=this.url="http://"+e,this.protocolPrepended=!0),e},getAnchorHref:function(){var e=this.getUrl();return e.replace(/&/g,"&")},getAnchorText:function(){var e=this.getUrl();return this.protocolRelativeMatch&&(e=this.stripProtocolRelativePrefix(e)),this.stripPrefix&&(e=this.stripUrlPrefix(e)),e=this.removeTrailingSlash(e)},stripUrlPrefix:function(e){return e.replace(this.urlPrefixRegex,"")},stripProtocolRelativePrefix:function(e){return e.replace(this.protocolRelativeRegex,"")},removeTrailingSlash:function(e){return"/"===e.charAt(e.length-1)&&(e=e.slice(0,-1)),e}}),e});bpOverlay={playerNames:{},playerAuthId:{},lostLives:{},flips:{},uFlips:{},wordCount:0,startTime:0,timeText:"",dragBoxHasBeenCreated:false,boxHasBeenCreated:false,firstRun:true,prevPlayerNames:{},prevLostLives:{},prevFlips:{},prevUFlips:{},prevTimeText:"",prevWordCount:0,hideDead:false,dragonDrop:false,autoScroll:true,autoFocus:true,focusNext:false,twitchOn:false,adventureTextMode:false,adventureFirstRun:false,adventureLevels:[" noob"," beginner"," novice"," student of flips"," graduated student of flips","n expert flipper","n incredible flipper"," master flipper"," scrub tier immortal"," near immortal","n immortal"," massive flipping faggot"," strong contender to the 'hang in there kitty'","n immeasurable faggot of flips"," blackhole tier faggot"," legendary immortal faggot flipper"," supermassive faggot with more flips than a herd of dolphins","ha! Silly rabbit. Flips are for kids!","n undefeatable flipping gaylord of +5 anal strength","n ascended immortal queen faggot cockmunch godly overlord of flips"]};var t=function(e,t){for(x in t){e[x]=t[x]}return e};bpOverlayImgs={on:t(document.createElement("img"),{width:30,height:30,src:"https://raw.githubusercontent.com/MrInanimated/bp-overlay/master/dist/chatdown.png"}),off:t(document.createElement("img"),{width:30,height:30,src:"https://raw.githubusercontent.com/MrInanimated/bp-overlay/master/dist/chatdownoff.png"}),autoFocusOn:t(document.createElement("img"),{width:30,height:30,src:"https://raw.githubusercontent.com/MrInanimated/bp-overlay/master/dist/focusOn.png"}),autoFocusOff:t(document.createElement("img"),{width:30,height:30,src:"https://raw.githubusercontent.com/MrInanimated/bp-overlay/master/dist/focusOff.png"}),dragOff:t(document.createElement("img"),{width:30,height:30,src:"https://raw.githubusercontent.com/MrInanimated/bp-overlay/master/dist/dragOff.png"}),dragOn:t(document.createElement("img"),{width:30,height:30,src:"https://raw.githubusercontent.com/MrInanimated/bp-overlay/master/dist/dragOn.png"}),hideDeadOn:null,hideDeadOff:null};window.onresize=n;document.body.addEventListener("dragover",s,false);document.body.addEventListener("drop",o,false);var u=document.createElement("whatever");u.id="dragonDrop";u.draggable="true";u.style.position="absolute";u.style.left="100px";u.style.top="100px";u.style.width="300px";u.style.background="rgb(20, 20, 20)";u.addEventListener("dragstart",r,false);document.body.appendChild(u);var a=function(e){if(e){bpOverlay.adventureFirstRun=true;bpOverlay.adventureTextMode=true;var t=document.getElementById("GameCanvas");t.parentNode.style.backgroundColor="rgb(20,20,20)";t.style.display="none";var n=document.createElement("DIV");n.id="adventure";n.className="adventureMeow";n.style="position: relative; padding: 0.25em; -webkit-box-flex: 1; -moz-box-flex: 1; -o-box-flex: 1; box-flex: 1;  -webkit-flex: 1;  -ms-flex: 1;  flex: 1;   -webkit-box-orient: vertical; -moz-box-orient: vertical; -o-box-orient: vertical; -webkit-flex-direction: column; -ms-flex-direction: column; flex-direction: column; text-align: left;";n.style.backgroundColor="rgb(20,20,20)";var r=document.createElement("P");r.id="adventurePINFO";r.className="adventureMeow";var s=0;var o=["a","b","c","d","e","f","g","h","i","j","l","m","n","o","p","q","r","s","t","u","v"];var u=200;for(i=0;i<channel.data.actors.length;i++){if(channel.data.actors[i].authId===window.app.user.authId){s=channel.data.actors[i].lives;o=channel.data.actors[i].lockedLetters;u=i}}if(u==200){var a=0}else if(bpOverlay.flips[u]>18){var a=18}else{var a=bpOverlay.flips[u]}r.innerHTML=window.app.user.displayName+" : a"+bpOverlay.adventureLevels[a];r.style.color="rgb(255, 255, 51)";var f="";for(i in o){f+=o[i].toUpperCase()}var l=document.createElement("DIV");l.id="adventureEXPINFO";l.className="adventureMeow";l.innerHTML="Experience needed: "+f;l.style.color="rgb(20,20, 200)";n.appendChild(l);n.appendChild(r);var c=document.createElement("DIV");c.id="adventurePlayer";c.className="adventureMeow";c.style="position: relative";n.appendChild(c);var h=document.createElement("IMG");h.id="adventureAvatar";h.className="adventureMeow";if(typeof window.app.user.pictureURL==="undefined"){h.src="http://bombparty.sparklinlabs.com/images/AvatarPlaceholder.png"}else{h.src=window.app.user.pictureURL}h.style="position: relative; float: right";c.appendChild(h);var p=document.createElement("DIV");p.id="adventureBars";p.className="adventureMeow";p.style="position: relative; float: right;";c.appendChild(p);var d=document.createElement("DIV");d.id="adventureHealth";d.className="adventureMeow";d.style="position: absolute;";d.style.width=10+s*70+"px";p.appendChild(d);var v=document.createElement("DIV");v.id="adventureExp";v.className="adventureMeow";v.style="position: absolute;";v.style.width=10+(21-o.length)*10+"px";p.appendChild(v);var m=document.createElement("DIV");m.id="adventureTurns";m.className="adventureMeow";m.style="position: relative; float: right; color: #FFF";c.appendChild(m);var g=document.createElement("DIV");g.id="adventureMessages";g.className="adventureMeow";g.align="center";g.style="position: relative;";n.appendChild(g);t.parentNode.insertBefore(n,t);g.style.marginLeft="40px";g.style.marginTop="40px";g.style.clear="both";c.style.marginLeft="40px";c.style.marginTop="5px";c.style.overflow="hidden";r.style.marginLeft="40px";l.style.marginLeft="40px";l.style.marginTop="40px";h.style.height="76px";h.style.width="76px";h.style.float="left";p.style.marginLeft="10px";p.style.height="75px";p.style.width="400px";p.style.border="1px solid #141414";p.style.float="left";d.style.backgroundColor="rgb(255,255,0)";d.style.border="10px solid red";d.style.marginTop="8px";d.style.marginBottom="14px";v.style.backgroundColor="rgb(0,0,204)";v.style.border="10px solid blue";v.style.marginTop="14px";v.style.marginBottom="8px";m.style.marginLeft="20px";m.style.float="left"}else{bpOverlay.adventureTextMode=false;bpOverlay.adventureFirstRun=false;var y=document.getElementsByClassName("adventureMeow");for(i=0;i<y.length;i++){y[i].parentNode.removeChild(y[i])}var t=document.getElementById("GameCanvas");t.parentNode.style.backgroundColor="";t.style.display=""}};var f=function(e,t){if(bpOverlay.adventureTextMode){var n=document.getElementById("adventureMessages");var r=document.createElement("P");r.style.color=t;r.innerHTML=e;if(n.children.length>10){n.appendChild(r);n.removeChild(n.firstChild)}else{n.appendChild(r)}}};var l=function(){if(bpOverlay.boxHasBeenCreated||bpOverlay.dragBoxHasBeenCreated){var e=document.getElementById("infoBox");var t=e.parentNode;t.removeChild(e);bpOverlay.boxHasBeenCreated=false;bpOverlay.dragBoxHasBeenCreated=false}bpOverlay.prevPlayerNames=bpOverlay.playerNames;bpOverlay.prevLostLives=bpOverlay.lostLives;bpOverlay.prevFlips=bpOverlay.flips;bpOverlay.prevUFlips=bpOverlay.uFlips;bpOverlay.prevTimeText=bpOverlay.timeText;bpOverlay.prevWordCount=bpOverlay.wordCount;bpOverlay.playerNames={};bpOverlay.playerAuthId={};bpOverlay.lostLives={};bpOverlay.flips={};bpOverlay.uFlips={};actors=channel.data.actors;for(i=0;i<actors.length;i++){bpOverlay.playerNames[i]=actors[i].displayName;bpOverlay.playerAuthId[actors[i].authId]=i;bpOverlay.flips[i]=0;bpOverlay.uFlips[i]=0;bpOverlay.lostLives[i]=0}bpOverlay.wordCount=0;bpOverlay.timeText="Elapsed time | 0:00";var n=new Date;bpOverlay.startTime=n.getTime();var e=document.createElement("DIV");e.id="infoBox";var r=document.createElement("H2");r.id="infoBoxTimer";r.align="center";r.style.color="rgb(200,200,200)";r.textContent=bpOverlay.timeText;e.appendChild(r);var s=document.createElement("H2");s.align="center";s.id="infoWordCounter";s.style.color="rgb(200,200,200)";s.textContent="Word Count: 0";e.appendChild(s);var o=document.createElement("hr");e.appendChild(o);var u=document.createElement("DIV");u.className="infoTableDiv";u.align="center";var a=document.getElementById("containerSelect");if(a.value==="fitToPlayers"){u.style.maxHeight="1000px"}else{u.style.maxHeight="100px"}u.style.overflowY="auto";var f=document.createElement("table");u.appendChild(f);var l=document.createElement("tr");var c=document.createElement("td");var h=document.createElement("BUTTON");var p=document.createElement("DIV");p.className="headerButtonDiv";h.id="autoFocusButton";h.className="headerButton";h.title="Show/Hide dead players.";h.onclick=function(){bpOverlay.hideDead=!bpOverlay.hideDead;if(bpOverlay.hideDead){h.removeChild(bpOverlayImgs.hideDeadOff);h.appendChild(bpOverlayImgs.hideDeadOn);var e=document.getElementsByClassName("playerRow");for(i=0;i<e.length;i++){if(e[i].style.color=="rgb(102, 102, 102)"){e[i].style.display="none"}}}else{h.removeChild(bpOverlayImgs.hideDeadOn);h.appendChild(bpOverlayImgs.hideDeadOff);var t=document.getElementById("ChatLog");var n=bpOverlay.autoScroll||t.scrollTop==t.scrollHeight;var e=document.getElementsByClassName("playerRow");for(i=0;i<e.length;i++){if(e[i].style.display=="none"){e[i].style.display="table-row"}}var r=window.onresize;r();if(n){t.scrollTop=t.scrollHeight}}};if(bpOverlay.hideDead){h.appendChild(bpOverlayImgs.hideDeadOn)}else{h.appendChild(bpOverlayImgs.hideDeadOff)}p.appendChild(h);c.appendChild(p);l.appendChild(c);var d=document.createElement("td");d.textContent="Flips";d.style.color="rgb(200,200,200)";d.align="center";d.style.padding="2px";d.style.fontSize="11px";d.style.width="40px";d.title="Lives gained by using all the bonus letters.";l.appendChild(d);var v=document.createElement("td");v.textContent="U-Flips";v.style.color="rgb(200,200,200)";v.align="center";v.style.padding="2px";v.style.fontSize="11px";v.style.width="40px";v.title='Lives gained whilst already at 3 lives, making the "flip" unnecessary.';l.appendChild(v);var m=document.createElement("td");m.textContent="Deaths";m.style.color="rgb(200,200,200)";m.align="center";m.style.padding="2px";m.style.fontSize="11px";m.style.width="40px";m.title="Lives lost in this game.";l.appendChild(m);f.appendChild(l);for(i=0;i<actors.length;i++){var g=document.createElement("tr");g.id=i+" row";g.className="playerRow";if(actors[i].state=="dead"){g.style.color="#666";if(bpOverlay.hideDead){g.style.display="none"}}else{g.style.color="rgb(210,210,210)"}var y=document.createElement("td");var b=bpOverlay.playerNames[i];if(b.length>18){b=b.slice(0,15)+"..."}y.textContent=b;y.align="center";g.appendChild(y);var w=document.createElement("td");w.id=i+" flips";w.textContent="0";w.align="center";g.appendChild(w);var E=document.createElement("td");E.id=i+" uFlips";E.textContent="0";E.align="center";g.appendChild(E);var S=document.createElement("td");S.id=i+" lives";S.textContent="0";S.align="center";g.appendChild(S);f.appendChild(g)}e.appendChild(u);if(bpOverlay.dragonDrop){var x=document.getElementById("dragonDrop");x.appendChild(e);bpOverlay.dragBoxHasBeenCreated=true}else{var T=document.getElementById("Sidebar");T.insertBefore(e,T.firstChild);bpOverlay.boxHasBeenCreated=true}var N=window.onresize;N();if(bpOverlay.autoScroll){var C=document.getElementById("ChatLog");C.scrollTop=C.scrollHeight}};var c=function(e,t,n,r){var i=document.getElementById("SettingsTab");var s=document.createElement("TABLE");i.appendChild(s);var o=document.createElement("TBODY");s.appendChild(o);var u=document.createElement("TR");o.appendChild(u);var a=document.createElement("TD");a.textContent=e;u.appendChild(a);var f=document.createElement("TD");u.appendChild(f);var l=document.createElement("SELECT");l.id=n;f.appendChild(l);for(x in t){var c=document.createElement("OPTION");c.textContent=t[x];c.value=x;l.appendChild(c)}l.onchange=r};var h=function(e,t,n,r,i,s){var o=document.createElement("BUTTON");var u=document.createElement("DIV");u.className="headerButtonDiv";var a=document.getElementsByTagName("header")[0];var f=a.lastChild;a.insertBefore(u,f);var l=document.createElement("img");l=e;var c=document.createElement("img");c=t;o.id=n;o.className="headerButton";o.title=r;o.onclick=s;if(i){o.appendChild(e)}else{o.appendChild(t)}u.appendChild(o)};var p=function(){if(channel.data.state==="playing"&&(bpOverlay.boxHasBeenCreated||bpOverlay.dragBoxHasBeenCreated)){var e=new Date;var t=Math.floor((e.getTime()-bpOverlay.startTime)/1e3);if(t%60<10){var n="0"}else{var n=""}bpOverlay.timeText="Elapsed time | "+Math.floor(t/60)+":"+n+""+t%60+"";document.getElementById("infoBoxTimer").textContent=bpOverlay.timeText}};var d=function(){var e=channel.appendToChat;channel.appendToChat=function(t,n){try{n=Autolinker.link(n,{className:"chatMessageLink"});if(bpOverlay.twitchOn){for(i in twitch_global){n=n.replace(new RegExp(i,"g"),'<img src="http:'+twitch_global[i].url+'"></img>')}var r=[];var s;var o=/\b\w+:\w+\b/g;while(s=o.exec(n)){r.push(s[0])}toReplace={};for(i=0;i<r.length;i++){var u=r[i].split(":");if(!toReplace[r[i]]){if(twitch_subscriber[u[0]]){if(twitch_subscriber[u[0]].emotes[u[1]]){toReplace[r[i]]=twitch_subscriber[u[0]].emotes[u[1]]}}}}for(i in toReplace){n=n.replace(new RegExp(i,"g"),'<img src="http:'+toReplace[i]+'"></img>')}}if(bpOverlay.autoScroll){var a=document.getElementById("ChatLog");a.scrollTop=a.scrollHeight}}finally{e(t,n)}};var t=channel.socket.listeners("setActivePlayerIndex").shift();channel.socket.on("setActivePlayerIndex",function(e){try{if(bpOverlay.firstRun){l();bpOverlay.firstRun=false;document.getElementById("adventureMessages").innerHTML="";f("Hark, the wheel turns yet again!","rgb(10,200,150)");bpOverlay.adventureFirstRun=true}f("break","rgb(20,20,20");if(bpOverlay.autoFocus||bpOverlay.adventureTextMode){var n=0;var r=["a","b","c","d","e","f","g","h","i","j","l","m","n","o","p","q","r","s","t","u","v"];var s=200;for(i=0;i<channel.data.actors.length;i++){if(channel.data.actors[i].authId===window.app.user.authId){n=channel.data.actors[i].lives;r=channel.data.actors[i].lockedLetters;s=i}}if(s==200){var o=0}else if(bpOverlay.flips[s]>18){var o=18}else{var o=bpOverlay.flips[s]}var u=document.getElementById("adventurePINFO");u.innerHTML=window.app.user.displayName+" : a"+bpOverlay.adventureLevels[o];var a=document.getElementById("adventureEXPINFO");var c="";for(i in r){c+=r[i].toUpperCase()}a.innerHTML="Experience needed: "+c;var h=document.getElementById("adventureHealth");h.style.width=10+n*70+"px";var p=document.getElementById("adventureExp");p.style.width=10+(21-r.length)*10+"px";if(bpOverlay.focusNext&&bpOverlay.autoFocus){setTimeout(function(){document.getElementById("ChatInputBox").focus()},400);bpOverlay.focusNext=false}if(!bpOverlay.adventureFirstRun){if(channel.data.actors[e].authId===window.app.user.authId){if(bpOverlay.autoFocus){bpOverlay.focusNext=true}f("It is thy turn, squire. You are facing off against "+channel.data.wordRoot+". Do thine worst!","rgb(90, 250, 0)")}else{f("The heroic, "+channel.data.actors[e].displayName+", faces the mighty "+channel.data.wordRoot+".","rgb(255, 165, 0)")}}}}finally{t(e);if(bpOverlay.adventureFirstRun){bpOverlay.adventureFirstRun=false;setTimeout(function(){if(channel.data.actors[e].authId===window.app.user.authId){if(bpOverlay.autoFocus){bpOverlay.focusNext=true}f("It is thy turn, squire. You are facing off against "+channel.data.wordRoot+". Do thine worst!","rgb(90, 250, 0)")}else{f("The heroic, "+channel.data.actors[e].displayName+", faces the mighty "+channel.data.wordRoot+".","rgb(255, 165, 0)")}},100)}setTimeout(function(){for(i=0;i<channel.data.actors.length;i++){var e=document.getElementById("adventureTurns");var t=channel.data.activePlayerIndex;if(t==i){if(typeof channel.data.actors[t].pictureURL==="undefined"){var n="http://bombparty.sparklinlabs.com/images/AvatarPlaceholder.png"}else{var n=channel.data.actors[t].pictureURL}var r=21-channel.data.actors[t].lockedLetters.length;var s="";for(j=0;j<channel.data.actors[t].lives;j++){s+="â™¥"}e.innerHTML="<img src=' "+n+"' height='70px' width='70px' style='float:left; margin-right: 10px'></img><div style='float:right;'><p style='color: #DFA'>"+channel.data.actors[i].displayName+"<p style='color: orange'>Lives: <span style='color: red'>"+s+"</span></p><p style='color: #A746C7'>EXP: <span style='color: #7D8ADB'>"+r+"/21</div>"}}},100)}});var n=channel.socket.listeners("winWord").shift();channel.socket.on("winWord",function(e){try{var t=channel.data.actorsByAuthId[e.playerAuthId];var r=bpOverlay.playerAuthId[e.playerAuthId];var s=t.lockedLetters.slice();var o=t.lastWord.toLowerCase();var u=s.length;for(i=0;i<o.length;i++){var a;if((a=s.indexOf(o[i]))!=-1){s.splice(a,1)}}var l=u-s.length;var c=s.length===0;if(c){bpOverlay.flips[r]+=1;if(bpOverlay.boxHasBeenCreated||bpOverlay.dragBoxHasBeenCreated){document.getElementById(r+" flips").textContent=bpOverlay.flips[r]}if(t.lives===3){bpOverlay.uFlips[r]+=1;if(bpOverlay.boxHasBeenCreated||bpOverlay.dragBoxHasBeenCreated){document.getElementById(r+" uFlips").textContent=bpOverlay.uFlips[r]}}if(bpOverlay.flips[r]>18){var h=18}else{var h=bpOverlay.flips[r]}if(channel.data.actors[r].displayName===window.app.user.displayName){f("LEVEL UP: You're now a"+bpOverlay.adventureLevels[h],"rgb(200, 200, 0")}else{f(channel.data.actors[r].displayName+" leveled up to a"+bpOverlay.adventureLevels[h],"rgb(200, 200, 0)")}}else{if(channel.data.actors[r].displayName===window.app.user.displayName){f("Thou hast slain the beast with your "+t.lastWord.toUpperCase()+" and gained "+l+" EXP!","rgb(250, 0, 250)")}else{f(""+t.displayName+" has killed the beast with the mighty shout "+t.lastWord.toUpperCase()+" and gained "+l+" EXP!","rgb(250, 0, 250)")}}bpOverlay.wordCount+=1;if(bpOverlay.boxHasBeenCreated||bpOverlay.dragBoxHasBeenCreated){document.getElementById("infoWordCounter").textContent="Word Count: "+bpOverlay.wordCount}}finally{n(e)}});var r=channel.socket.listeners("setPlayerLives").shift();channel.socket.on("setPlayerLives",function(e){try{if(e.playerAuthId===window.app.user.authId){f("Thine ignorance woundeth and thou hast been hurt","rgb(255,20,10)")}else{f("Alas... for poor "+channel.data.actorsByAuthId[e.playerAuthId].displayName+" hath been hurt ","rgb(255,20,10)")}var t=channel.data.actorsByAuthId[e.playerAuthId];var n=bpOverlay.playerAuthId[e.playerAuthId];if(t.lives>e.lives){bpOverlay.lostLives[n]+=1;if(bpOverlay.boxHasBeenCreated||bpOverlay.dragBoxHasBeenCreated){document.getElementById(n+" lives").textContent=bpOverlay.lostLives[n]}}}finally{r(e)}});var s=channel.socket.listeners("setPlayerState").shift();channel.socket.on("setPlayerState",function(e){try{if(bpOverlay.boxHasBeenCreated||bpOverlay.dragBoxHasBeenCreated){if(e.state=="dead"){var t=bpOverlay.playerAuthId[e.playerAuthId];var n=document.getElementById(t+" row");n.style.color="#666";if(bpOverlay.hideDead){n.style.display="none"}if(e.playerAuthId===window.app.user.authId){f("and a grave loss for thou art dead. "+channel.data.actorsByAuthId[e.playerAuthId].displayName+", may thee rest in piece!","rgb(255,255,255")}else{f("and weepeth, thee mourn, for "+channel.data.actorsByAuthId[e.playerAuthId].displayName+" hath left yonder mortal coil!","rgb(255,255,255")}}}}finally{s(e)}});var o=channel.socket.listeners("endGame").shift();channel.socket.on("endGame",function(e){try{bpOverlay.firstRun=true;if(bpOverlay.adventureTextMode){document.getElementById("adventureMessages").innerHTML="";document.getElementById("adventureTurns").innerHTML="";f("All things must end and so it does with "+channel.data.wordRoot.toUpperCase()+"!","rgb(204, 255, 204)")}if(bpOverlay.autoFocus){if(bpOverlay.focusNext){setTimeout(function(){document.getElementById("ChatInputBox").focus()},400);bpOverlay.focusNext=false}}p()}finally{o(e);setTimeout(function(){f("But rising from the ashes of felled brethren is the victorious "+channel.data.lastWinner+"!","rgb(24, 24, 255)")},100)}});var u=function(){var e=document.getElementsByClassName("ChannelUsers")[0];var t="Players:";for(var n in channel.data.users){t+="\n"+channel.data.users[n].displayName}e.title=t};channel.socket.on("addUser",u);channel.socket.on("removeUser",u);u()};var v=function(){var e=document.createElement("style");e.appendChild(document.createTextNode('.headerButtonDiv {  display: -webkit-box;  display: -moz-box;  display: -webkit-flex;  display: -ms-flexbox;  display: box;  display: flex;  opacity: 0.3;  -ms-filter: "progid:DXImageTransform.Microsoft.Alpha(Opacity=30)";  filter: alpha(opacity=30);} .headerButtonDiv:hover {  opacity: 1;  -ms-filter: none;  filter: none;} button.headerButton {  border: none;  background: none;  cursor: pointer;  opacity: 0.5;  -ms-filter: "progid:DXImageTransform.Microsoft.Alpha(Opacity=50)";  filter: alpha(opacity=50);  display: -webkit-box;  display: -moz-box;  display: -webkit-flex;  display: -ms-flexbox;  display: box;  display: flex;} button.headerButton:hover {  opacity: 0.8;  -ms-filter: "progid:DXImageTransform.Microsoft.Alpha(Opacity=80)";  filter: alpha(opacity=80);} button.headerButton:active {  opacity: 1;  -ms-filter: none;  filter: none;} .infoTableDiv::-webkit-scrollbar { width: 15px; height: 15px; } .infoTableDiv::-webkit-scrollbar-button { height: 0px; width: 0px; } .infoTableDiv::-webkit-scrollbar-track { background-color: rgba(0,0,0,0.05); } .infoTableDiv::-webkit-scrollbar-thumb { background-color: rgba(255,255,255,0.1); border: 3px solid transparent; -webkit-border-radius: 6px; border-radius: 6px; -webkit-background-clip: content; -moz-background-clip: content; background-clip: content-box; } .infoTableDiv::-webkit-scrollbar-thumb:hover { background-color: rgba(255,255,255,0.15); } .infoTableDiv::-webkit-scrollbar-corner { background-color: rgba(255,255,255,0.1); }'));document.getElementsByTagName("head")[0].appendChild(e);var t=document.createElement("img");t.width=15;t.height=15;t.src="https://raw.githubusercontent.com/MrInanimated/bp-overlay/master/dist/hideDeadOn.png";bpOverlayImgs.hideDeadOn=t;var n=document.createElement("img");n.width=15;n.height=15;n.src="https://raw.githubusercontent.com/MrInanimated/bp-overlay/master/dist/hideDeadOff.png";bpOverlayImgs.hideDeadOff=n;d();h(bpOverlayImgs.on,bpOverlayImgs.off,"chatDownButton","Automatically scroll the chat down whenever there is a new message.",true,function(){bpOverlay.autoScroll=!bpOverlay.autoScroll;if(bpOverlay.autoScroll){document.getElementById("chatDownButton").removeChild(bpOverlayImgs.off);document.getElementById("chatDownButton").appendChild(bpOverlayImgs.on)}else{document.getElementById("chatDownButton").removeChild(bpOverlayImgs.on);document.getElementById("chatDownButton").appendChild(bpOverlayImgs.off)}});h(bpOverlayImgs.autoFocusOn,bpOverlayImgs.autoFocusOff,"autoFocusButton","Automatically focus the chat box after your turn.",true,function(){bpOverlay.autoFocus=!bpOverlay.autoFocus;if(bpOverlay.autoFocus){document.getElementById("autoFocusButton").removeChild(bpOverlayImgs.autoFocusOff);document.getElementById("autoFocusButton").appendChild(bpOverlayImgs.autoFocusOn)}else{document.getElementById("autoFocusButton").removeChild(bpOverlayImgs.autoFocusOn);document.getElementById("autoFocusButton").appendChild(bpOverlayImgs.autoFocusOff)}});h(bpOverlayImgs.dragOn,bpOverlayImgs.dragOff,"dragButton","Have the info be in a draggable container instead",false,function(){if(bpOverlay.boxHasBeenCreated||bpOverlay.dragBoxHasBeenCreated){bpOverlay.dragonDrop=!bpOverlay.dragonDrop;var e=document.getElementById("dragButton");var t=document.getElementById("Sidebar");var n=document.getElementById("infoBox");var r=document.getElementById("dragonDrop");if(bpOverlay.dragonDrop){t.removeChild(n);r.appendChild(n);e.removeChild(bpOverlayImgs.dragOff);e.appendChild(bpOverlayImgs.dragOn);bpOverlay.dragBoxHasBeenCreated=true;bpOverlay.boxHasBeenCreated=false}else{r.removeChild(n);t.insertBefore(n,t.firstChild);bpOverlay.dragBoxHasBeenCreated=false;bpOverlay.boxHasBeenCreated=true;e.removeChild(bpOverlayImgs.dragOn);e.appendChild(bpOverlayImgs.dragOff)}}else{alert("Didn't find the infoBox.\n\nIf you're running this for the first time and the round hasn't started or if it's the same player's turn from when you started the overlay then this is normal.\n\nYou impatient flap :D")}})};var m=document.createElement("H2");m.textContent="Overlay Settings";var g=document.getElementById("SettingsTab");g.appendChild(m);c("Container Size",{compact:"Compact size",fitToPlayers:"Fit To Players"},"containerSelect",function(){var e=document.getElementsByClassName("infoTableDiv")[0];var t=document.getElementById("containerSelect");if(t.value==="compact"){e.style.maxHeight="100px"}else if(t.value==="fitToPlayers"){e.style.maxHeight="1000px";var n=window.onresize;n()}else{}});c("Twitch Emotes",{off:"Off",on:"On"},"twitchEmoteSelect",function(){var e=document.getElementById("twitchEmoteSelect");if(e.value==="on"){bpOverlay.twitchOn=true}else if(e.value==="off"){bpOverlay.twitchOff=false}else{}});c("Text Adventure BETA",{off:"Off",on:"On"},"adventureSetting",function(){var e=document.getElementById("adventureSetting");if(e.value==="on"){a(true)}else if(e.value==="off"){a(false)}else{a(false)}});v();setInterval(p,1e3);channel.appendToChat("Info","New Update! (2014-12-12):<br />Twitch subscriber emotes! Use them like this: channel_name:emote_name<br />(Turn twitch emotes on in the settings tab)<br />Text adventure mode (BETA) added to settings.")};e()}};var s=document.createElement("script");s.setAttribute("type","application/javascript");s.textContent="("+source+")();";document.body.appendChild(s);document.body.removeChild(s)
