// ==UserScript==
// @name         BombParty Overlay
// @version      1.1.1
// @description  Overlay + Utilities for BombParty!
// @icon         https://raw.githubusercontent.com/MrInanimated/bp-overlay/master/dist/icon.png
// @icon64       https://raw.githubusercontent.com/MrInanimated/bp-overlay/master/dist/icon64.png
// @downloadURL  https://github.com/MrInanimated/bp-overlay/raw/master/dist/bpoverlay.min.user.js
// @author       Tianlin Zhang
// @match        http://bombparty.sparklinlabs.com/play/*
// @grant        none
// ==/UserScript==

// If you would like to see un-minified JS, it's available at https://github.com/MrInanimated/bp-overlay/blob/master/dist/bpoverlay.user.js

var source=function(){if(window.hasOwnProperty("BPOverlayHasRun")){}else{window.BPOverlayHasRun=true;var e=function(){function t(e){var t=window.getComputedStyle(e.target,null);e.dataTransfer.setData("text/plain",parseInt(t.getPropertyValue("left"),10)-e.clientX+","+(parseInt(t.getPropertyValue("top"),10)-e.clientY))}function n(e){e.preventDefault();return false}function r(e){var t=e.dataTransfer.getData("text/plain").split(",");var n=document.getElementById("dragonDrop");n.style.left=e.clientX+parseInt(t[0],10)+"px";n.style.top=e.clientY+parseInt(t[1],10)+"px";e.preventDefault();return false}if(!(window.hasOwnProperty("channel")&&channel.socket&&channel.data&&channel.appendToChat&&channel.socket.listeners("setActivePlayerIndex").length&&channel.socket.listeners("winWord").length&&channel.socket.listeners("setPlayerLives").length&&channel.socket.listeners("setPlayerState").length&&channel.socket.listeners("endGame").length)){console.log("Everything's not loaded yet, trying again in a second...");setTimeout(e,1e3);return}!function(e,t){"function"==typeof define&&define.amd?define([],function(){return e.returnExportsGlobal=t()}):"object"==typeof exports?module.exports=t():e.Autolinker=t()}(this,function(){var e=function(t){e.Util.assign(this,t),this.matchValidator=new e.MatchValidator};return e.prototype={constructor:e,urls:!0,email:!0,twitter:!0,newWindow:!0,stripPrefix:!0,className:"",htmlCharacterEntitiesRegex:/(&nbsp;|&#160;|&lt;|&#60;|&gt;|&#62;)/gi,matcherRegex:function(){var e=/(^|[^\w])@(\w{1,15})/,t=/(?:[\-;:&=\+\$,\w\.]+@)/,n=/(?:[A-Za-z][-.+A-Za-z0-9]+:(?![A-Za-z][-.+A-Za-z0-9]+:\/\/)(?!\d+\/?)(?:\/\/)?)/,r=/(?:www\.)/,i=/[A-Za-z0-9\.\-]*[A-Za-z0-9\-]/,s=/\.(?:international|construction|contractors|enterprises|photography|productions|foundation|immobilien|industries|management|properties|technology|christmas|community|directory|education|equipment|institute|marketing|solutions|vacations|bargains|boutique|builders|catering|cleaning|clothing|computer|democrat|diamonds|graphics|holdings|lighting|partners|plumbing|supplies|training|ventures|academy|careers|company|cruises|domains|exposed|flights|florist|gallery|guitars|holiday|kitchen|neustar|okinawa|recipes|rentals|reviews|shiksha|singles|support|systems|agency|berlin|camera|center|coffee|condos|dating|estate|events|expert|futbol|kaufen|luxury|maison|monash|museum|nagoya|photos|repair|report|social|supply|tattoo|tienda|travel|viajes|villas|vision|voting|voyage|actor|build|cards|cheap|codes|dance|email|glass|house|mango|ninja|parts|photo|shoes|solar|today|tokyo|tools|watch|works|aero|arpa|asia|best|bike|blue|buzz|camp|club|cool|coop|farm|fish|gift|guru|info|jobs|kiwi|kred|land|limo|link|menu|mobi|moda|name|pics|pink|post|qpon|rich|ruhr|sexy|tips|vote|voto|wang|wien|wiki|zone|bar|bid|biz|cab|cat|ceo|com|edu|gov|int|kim|mil|net|onl|org|pro|pub|red|tel|uno|wed|xxx|xyz|ac|ad|ae|af|ag|ai|al|am|an|ao|aq|ar|as|at|au|aw|ax|az|ba|bb|bd|be|bf|bg|bh|bi|bj|bm|bn|bo|br|bs|bt|bv|bw|by|bz|ca|cc|cd|cf|cg|ch|ci|ck|cl|cm|cn|co|cr|cu|cv|cw|cx|cy|cz|de|dj|dk|dm|do|dz|ec|ee|eg|er|es|et|eu|fi|fj|fk|fm|fo|fr|ga|gb|gd|ge|gf|gg|gh|gi|gl|gm|gn|gp|gq|gr|gs|gt|gu|gw|gy|hk|hm|hn|hr|ht|hu|id|ie|il|im|in|io|iq|ir|is|it|je|jm|jo|jp|ke|kg|kh|ki|km|kn|kp|kr|kw|ky|kz|la|lb|lc|li|lk|lr|ls|lt|lu|lv|ly|ma|mc|md|me|mg|mh|mk|ml|mm|mn|mo|mp|mq|mr|ms|mt|mu|mv|mw|mx|my|mz|na|nc|ne|nf|ng|ni|nl|no|np|nr|nu|nz|om|pa|pe|pf|pg|ph|pk|pl|pm|pn|pr|ps|pt|pw|py|qa|re|ro|rs|ru|rw|sa|sb|sc|sd|se|sg|sh|si|sj|sk|sl|sm|sn|so|sr|st|su|sv|sx|sy|sz|tc|td|tf|tg|th|tj|tk|tl|tm|tn|to|tp|tr|tt|tv|tw|tz|ua|ug|uk|us|uy|uz|va|vc|ve|vg|vi|vn|vu|wf|ws|ye|yt|za|zm|zw)\b/,o=/[\-A-Za-z0-9+&@#\/%=~_()|'$*\[\]?!:,.;]*[\-A-Za-z0-9+&@#\/%=~_()|'$*\[\]]/;return new RegExp(["(",e.source,")","|","(",t.source,i.source,s.source,")","|","(","(?:","(",n.source,i.source,")","|","(?:","(.?//)?",r.source,i.source,")","|","(?:","(.?//)?",i.source,s.source,")",")","(?:"+o.source+")?",")"].join(""),"gi")}(),charBeforeProtocolRelMatchRegex:/^(.)?\/\//,link:function(t){var n=this,r=this.getHtmlParser(),i=this.htmlCharacterEntitiesRegex,s=0,o=[];return r.parse(t,{processHtmlNode:function(e,t,n){"a"===t&&(n?s=Math.max(s-1,0):s++),o.push(e)},processTextNode:function(t){if(0===s)for(var r=e.Util.splitAndCapture(t,i),u=0,a=r.length;a>u;u++){var f=r[u],l=n.processTextNode(f);o.push(l)}else o.push(t)}}),o.join("")},getHtmlParser:function(){var t=this.htmlParser;return t||(t=this.htmlParser=new e.HtmlParser),t},getTagBuilder:function(){var t=this.tagBuilder;return t||(t=this.tagBuilder=new e.AnchorTagBuilder({newWindow:this.newWindow,truncate:this.truncate,className:this.className})),t},processTextNode:function(e){var t=this;return e.replace(this.matcherRegex,function(e,n,r,i,s,o,u,a,f){var l=t.processCandidateMatch(e,n,r,i,s,o,u,a,f);if(l){var c=t.createMatchReturnVal(l.match,l.matchStr);return l.prefixStr+c+l.suffixStr}return e})},processCandidateMatch:function(t,n,r,i,s,o,u,a,f){var l,c=a||f,h="",p="";if(n&&!this.twitter||s&&!this.email||o&&!this.urls||!this.matchValidator.isValidMatch(o,u,c))return null;if(this.matchHasUnbalancedClosingParen(t)&&(t=t.substr(0,t.length-1),p=")"),s)l=new e.match.Email({matchedText:t,email:s});else if(n)r&&(h=r,t=t.slice(1)),l=new e.match.Twitter({matchedText:t,twitterHandle:i});else{if(c){var d=c.match(this.charBeforeProtocolRelMatchRegex)[1]||"";d&&(h=d,t=t.slice(1))}l=new e.match.Url({matchedText:t,url:t,protocolUrlMatch:!!u,protocolRelativeMatch:!!c,stripPrefix:this.stripPrefix})}return{prefixStr:h,suffixStr:p,matchStr:t,match:l}},matchHasUnbalancedClosingParen:function(e){var t=e.charAt(e.length-1);if(")"===t){var n=e.match(/\(/g),r=e.match(/\)/g),i=n&&n.length||0,s=r&&r.length||0;if(s>i)return!0}return!1},createMatchReturnVal:function(t,n){var r;if(this.replaceFn&&(r=this.replaceFn.call(this,this,t)),"string"==typeof r)return r;if(r===!1)return n;if(r instanceof e.HtmlTag)return r.toString();var i=this.getTagBuilder(),s=i.build(t);return s.toString()}},e.link=function(t,n){var r=new e(n);return r.link(t)},e.match={},e.Util={abstractMethod:function(){throw"abstract"},assign:function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);return e},extend:function(t,n){var r=t.prototype,i=function(){};i.prototype=r;var s;s=n.hasOwnProperty("constructor")?n.constructor:function(){r.constructor.apply(this,arguments)};var o=s.prototype=new i;return o.constructor=s,o.superclass=r,delete n.constructor,e.Util.assign(o,n),s},ellipsis:function(e,t,n){return e.length>t&&(n=null==n?"..":n,e=e.substring(0,t-n.length)+n),e},indexOf:function(e,t){if(Array.prototype.indexOf)return e.indexOf(t);for(var n=0,r=e.length;r>n;n++)if(e[n]===t)return n;return-1},splitAndCapture:function(e,t){if(!t.global)throw new Error("`splitRegex` must have the 'g' flag set");for(var n,r=[],i=0;n=t.exec(e);)r.push(e.substring(i,n.index)),r.push(n[0]),i=n.index+n[0].length;return r.push(e.substring(i)),r}},e.HtmlParser=e.Util.extend(Object,{htmlRegex:function(){var e=/[0-9a-zA-Z][0-9a-zA-Z:]*/,t=/[^\s\0"'>\/=\x01-\x1F\x7F]+/,n=/(?:".*?"|'.*?'|[^'"=<>`\s]+)/,r=t.source+"(?:\\s*=\\s*"+n.source+")?";return new RegExp(["(?:","<(!DOCTYPE)","(?:","\\s+","(?:",r,"|",n.source+")",")*",">",")","|","(?:","<(/)?","("+e.source+")","(?:","\\s+",r,")*","\\s*/?",">",")"].join(""),"gi")}(),parse:function(e,t){t=t||{};for(var n,r=t.processHtmlNode||function(){},i=t.processTextNode||function(){},s=this.htmlRegex,o=0;null!==(n=s.exec(e));){var u=n[0],a=n[1]||n[3],f=!!n[2],l=e.substring(o,n.index);l&&i(l),r(u,a.toLowerCase(),f),o=n.index+u.length}if(o<e.length){var c=e.substring(o);c&&i(c)}}}),e.HtmlTag=e.Util.extend(Object,{whitespaceRegex:/\s+/,constructor:function(t){e.Util.assign(this,t),this.innerHtml=this.innerHtml||this.innerHTML},setTagName:function(e){return this.tagName=e,this},getTagName:function(){return this.tagName||""},setAttr:function(e,t){var n=this.getAttrs();return n[e]=t,this},getAttr:function(e){return this.getAttrs()[e]},setAttrs:function(t){var n=this.getAttrs();return e.Util.assign(n,t),this},getAttrs:function(){return this.attrs||(this.attrs={})},setClass:function(e){return this.setAttr("class",e)},addClass:function(t){for(var n,r=this.getClass(),i=this.whitespaceRegex,s=e.Util.indexOf,o=r?r.split(i):[],u=t.split(i);n=u.shift();)-1===s(o,n)&&o.push(n);return this.getAttrs()["class"]=o.join(" "),this},removeClass:function(t){for(var n,r=this.getClass(),i=this.whitespaceRegex,s=e.Util.indexOf,o=r?r.split(i):[],u=t.split(i);o.length&&(n=u.shift());){var a=s(o,n);-1!==a&&o.splice(a,1)}return this.getAttrs()["class"]=o.join(" "),this},getClass:function(){return this.getAttrs()["class"]||""},hasClass:function(e){return-1!==(" "+this.getClass()+" ").indexOf(" "+e+" ")},setInnerHtml:function(e){return this.innerHtml=e,this},getInnerHtml:function(){return this.innerHtml||""},toString:function(){var e=this.getTagName(),t=this.buildAttrsStr();return t=t?" "+t:"",["<",e,t,">",this.getInnerHtml(),"</",e,">"].join("")},buildAttrsStr:function(){if(!this.attrs)return"";var e=this.getAttrs(),t=[];for(var n in e)e.hasOwnProperty(n)&&t.push(n+'="'+e[n]+'"');return t.join(" ")}}),e.MatchValidator=e.Util.extend(Object,{invalidProtocolRelMatchRegex:/^[\w]\/\//,hasFullProtocolRegex:/^[A-Za-z][-.+A-Za-z0-9]+:\/\//,uriSchemeRegex:/^[A-Za-z][-.+A-Za-z0-9]+:/,hasWordCharAfterProtocolRegex:/:[^\s]*?[A-Za-z]/,isValidMatch:function(e,t,n){return t&&!this.isValidUriScheme(t)||this.urlMatchDoesNotHaveProtocolOrDot(e,t)||this.urlMatchDoesNotHaveAtLeastOneWordChar(e,t)||this.isInvalidProtocolRelativeMatch(n)?!1:!0},isValidUriScheme:function(e){var t=e.match(this.uriSchemeRegex)[0];return"javascript:"!==t&&"vbscript:"!==t},urlMatchDoesNotHaveProtocolOrDot:function(e,t){return!(!e||t&&this.hasFullProtocolRegex.test(t)||-1!==e.indexOf("."))},urlMatchDoesNotHaveAtLeastOneWordChar:function(e,t){return e&&t?!this.hasWordCharAfterProtocolRegex.test(e):!1},isInvalidProtocolRelativeMatch:function(e){return!!e&&this.invalidProtocolRelMatchRegex.test(e)}}),e.AnchorTagBuilder=e.Util.extend(Object,{constructor:function(t){e.Util.assign(this,t)},build:function(t){var n=new e.HtmlTag({tagName:"a",attrs:this.createAttrs(t.getType(),t.getAnchorHref()),innerHtml:this.processAnchorText(t.getAnchorText())});return n},createAttrs:function(e,t){var n={href:t},r=this.createCssClass(e);return r&&(n["class"]=r),this.newWindow&&(n.target="_blank"),n},createCssClass:function(e){var t=this.className;return t?t+" "+t+"-"+e:""},processAnchorText:function(e){return e=this.doTruncate(e)},doTruncate:function(t){return e.Util.ellipsis(t,this.truncate||Number.POSITIVE_INFINITY)}}),e.match.Match=e.Util.extend(Object,{constructor:function(t){e.Util.assign(this,t)},getType:e.Util.abstractMethod,getMatchedText:function(){return this.matchedText},getAnchorHref:e.Util.abstractMethod,getAnchorText:e.Util.abstractMethod}),e.match.Email=e.Util.extend(e.match.Match,{getType:function(){return"email"},getEmail:function(){return this.email},getAnchorHref:function(){return"mailto:"+this.email},getAnchorText:function(){return this.email}}),e.match.Twitter=e.Util.extend(e.match.Match,{getType:function(){return"twitter"},getTwitterHandle:function(){return this.twitterHandle},getAnchorHref:function(){return"https://twitter.com/"+this.twitterHandle},getAnchorText:function(){return"@"+this.twitterHandle}}),e.match.Url=e.Util.extend(e.match.Match,{urlPrefixRegex:/^(https?:\/\/)?(www\.)?/i,protocolRelativeRegex:/^\/\//,protocolPrepended:!1,getType:function(){return"url"},getUrl:function(){var e=this.url;return this.protocolRelativeMatch||this.protocolUrlMatch||this.protocolPrepended||(e=this.url="http://"+e,this.protocolPrepended=!0),e},getAnchorHref:function(){var e=this.getUrl();return e.replace(/&/g,"&")},getAnchorText:function(){var e=this.getUrl();return this.protocolRelativeMatch&&(e=this.stripProtocolRelativePrefix(e)),this.stripPrefix&&(e=this.stripUrlPrefix(e)),e=this.removeTrailingSlash(e)},stripUrlPrefix:function(e){return e.replace(this.urlPrefixRegex,"")},stripProtocolRelativePrefix:function(e){return e.replace(this.protocolRelativeRegex,"")},removeTrailingSlash:function(e){return"/"===e.charAt(e.length-1)&&(e=e.slice(0,-1)),e}}),e});bpOverlay={playerNames:{},playerAuthId:{},lostLives:{},flips:{},uFlips:{},wordCount:0,startTime:0,timeText:"",dragBoxHasBeenCreated:false,boxHasBeenCreated:false,firstRun:true,prevPlayerNames:{},prevLostLives:{},prevFlips:{},prevUFlips:{},prevTimeText:"",prevWordCount:0,hideDead:false,dragonDrop:false,autoScroll:true,autoFocus:true,focusNext:false};bpOverlayImgs={on:null,off:null,autoFocusOn:null,autoFocusOff:null,hideDeadOn:null,hideDeadOff:null,dragOff:null,dragOn:null};document.body.addEventListener("dragover",n,false);document.body.addEventListener("drop",r,false);var s=document.createElement("whatever");s.id="dragonDrop";s.draggable="true";s.style.position="absolute";s.style.left="100px";s.style.top="100px";s.style.width="300px";s.style.background="rgb(20, 20, 20)";s.addEventListener("dragstart",t,false);document.body.appendChild(s);var o=function(){if(bpOverlay.boxHasBeenCreated||bpOverlay.dragBoxHasBeenCreated){var e=document.getElementById("infoBox");var t=e.parentNode;t.removeChild(e);bpOverlay.boxHasBeenCreated=false;bpOverlay.dragBoxHasBeenCreated=false}bpOverlay.prevPlayerNames=bpOverlay.playerNames;bpOverlay.prevLostLives=bpOverlay.lostLives;bpOverlay.prevFlips=bpOverlay.flips;bpOverlay.prevUFlips=bpOverlay.uFlips;bpOverlay.prevTimeText=bpOverlay.timeText;bpOverlay.prevWordCount=bpOverlay.wordCount;bpOverlay.playerNames={};bpOverlay.playerAuthId={};bpOverlay.lostLives={};bpOverlay.flips={};bpOverlay.uFlips={};actors=channel.data.actors;for(i=0;i<actors.length;i++){bpOverlay.playerNames[i]=actors[i].displayName;bpOverlay.playerAuthId[actors[i].authId]=i;bpOverlay.flips[i]=0;bpOverlay.uFlips[i]=0;bpOverlay.lostLives[i]=0}bpOverlay.wordCount=0;bpOverlay.timeText="Elapsed time | 0:00";var n=new Date;bpOverlay.startTime=n.getTime();var e=document.createElement("DIV");e.id="infoBox";var r=document.createElement("H2");r.id="infoBoxTimer";r.align="center";r.style.color="rgb(200,200,200)";r.textContent=bpOverlay.timeText;e.appendChild(r);var s=document.createElement("H2");s.align="center";s.id="infoWordCounter";s.style.color="rgb(200,200,200)";s.textContent="Word Count: 0";e.appendChild(s);var o=document.createElement("hr");e.appendChild(o);var u=document.createElement("DIV");u.className="infoTableDiv";u.align="center";u.style.maxHeight="100px";u.style.overflowY="auto";var a=document.createElement("table");u.appendChild(a);var f=document.createElement("tr");var l=document.createElement("td");var c=document.createElement("BUTTON");var h=document.createElement("DIV");h.className="headerButtonDiv";c.id="autoFocusButton";c.className="headerButton";c.title="Show/Hide dead players.";c.onclick=function(){bpOverlay.hideDead=!bpOverlay.hideDead;if(bpOverlay.hideDead){c.removeChild(bpOverlayImgs.hideDeadOff);c.appendChild(bpOverlayImgs.hideDeadOn);var e=document.getElementsByClassName("playerRow");for(i=0;i<e.length;i++){if(e[i].style.color=="rgb(102, 102, 102)"){e[i].style.display="none"}}}else{c.removeChild(bpOverlayImgs.hideDeadOn);c.appendChild(bpOverlayImgs.hideDeadOff);var t=document.getElementById("ChatLog");var n=bpOverlay.autoScroll||t.scrollTop==t.scrollHeight;var e=document.getElementsByClassName("playerRow");for(i=0;i<e.length;i++){if(e[i].style.display=="none"){e[i].style.display="table-row"}}if(n){t.scrollTop=t.scrollHeight}}};if(bpOverlay.hideDead){c.appendChild(bpOverlayImgs.hideDeadOn)}else{c.appendChild(bpOverlayImgs.hideDeadOff)}h.appendChild(c);l.appendChild(h);f.appendChild(l);var p=document.createElement("td");p.textContent="Flips";p.style.color="rgb(200,200,200)";p.align="center";p.style.padding="2px";p.style.fontSize="11px";p.style.width="40px";p.title="Lives gained by using all the bonus letters.";f.appendChild(p);var d=document.createElement("td");d.textContent="U-Flips";d.style.color="rgb(200,200,200)";d.align="center";d.style.padding="2px";d.style.fontSize="11px";d.style.width="40px";d.title='Lives gained whilst already at 3 lives, making the "flip" unnecessary.';f.appendChild(d);var v=document.createElement("td");v.textContent="Deaths";v.style.color="rgb(200,200,200)";v.align="center";v.style.padding="2px";v.style.fontSize="11px";v.style.width="40px";v.title="Lives lost in this game.";f.appendChild(v);a.appendChild(f);for(i=0;i<actors.length;i++){var m=document.createElement("tr");m.id=i+" row";m.className="playerRow";if(actors[i].state=="dead"){m.style.color="#666";if(bpOverlay.hideDead){m.style.display="none"}}else{m.style.color="rgb(210,210,210)"}var g=document.createElement("td");var y=bpOverlay.playerNames[i];if(y.length>18){y=y.slice(0,15)+"..."}g.textContent=y;g.align="center";m.appendChild(g);var b=document.createElement("td");b.id=i+" flips";b.textContent="0";b.align="center";m.appendChild(b);var w=document.createElement("td");w.id=i+" uFlips";w.textContent="0";w.align="center";m.appendChild(w);var E=document.createElement("td");E.id=i+" lives";E.textContent="0";E.align="center";m.appendChild(E);a.appendChild(m)}e.appendChild(u);if(bpOverlay.dragonDrop){var S=document.getElementById("dragonDrop");S.appendChild(e);bpOverlay.dragBoxHasBeenCreated=true}else{var x=document.getElementById("Sidebar");x.insertBefore(e,x.firstChild);bpOverlay.boxHasBeenCreated=true}if(bpOverlay.autoScroll){var T=document.getElementById("ChatLog");T.scrollTop=T.scrollHeight}};var u=function(){var e=document.createElement("img");e.width=30;e.height=30;e.src="https://raw.githubusercontent.com/MrInanimated/bp-overlay/master/dist/chatdown.png";bpOverlayImgs.on=e;var t=document.createElement("img");t.width=30;t.height=30;t.src="https://raw.githubusercontent.com/MrInanimated/bp-overlay/master/dist/chatdownoff.png";bpOverlayImgs.off=t;var n=document.createElement("BUTTON");var r=document.createElement("DIV");r.className="headerButtonDiv";var i=document.getElementsByTagName("header")[0];var s=i.lastChild;i.insertBefore(r,s);n.id="chatDownButton";n.className="headerButton";n.title="Automatically scroll the chat down whenever there is a new message.";n.onclick=function(){bpOverlay.autoScroll=!bpOverlay.autoScroll;if(bpOverlay.autoScroll){n.removeChild(bpOverlayImgs.off);n.appendChild(bpOverlayImgs.on)}else{n.removeChild(bpOverlayImgs.on);n.appendChild(bpOverlayImgs.off)}};n.appendChild(bpOverlayImgs.on);r.appendChild(n)};var a=function(){var e=document.createElement("img");e.width=30;e.height=30;e.src="https://raw.githubusercontent.com/MrInanimated/bp-overlay/master/dist/focusOn.png";bpOverlayImgs.autoFocusOn=e;var t=document.createElement("img");t.width=30;t.height=30;t.src="https://raw.githubusercontent.com/MrInanimated/bp-overlay/master/dist/focusOff.png";bpOverlayImgs.autoFocusOff=t;var n=document.createElement("BUTTON");var r=document.createElement("DIV");r.className="headerButtonDiv";var i=document.getElementsByTagName("header")[0];var s=i.lastChild;i.insertBefore(r,s);n.id="autoFocusButton";n.className="headerButton";n.title="Automatically focus the chat box after your turn.";n.onclick=function(){bpOverlay.autoFocus=!bpOverlay.autoFocus;if(bpOverlay.autoFocus){n.removeChild(bpOverlayImgs.autoFocusOff);n.appendChild(bpOverlayImgs.autoFocusOn)}else{n.removeChild(bpOverlayImgs.autoFocusOn);n.appendChild(bpOverlayImgs.autoFocusOff)}};n.appendChild(bpOverlayImgs.autoFocusOn);r.appendChild(n)};var f=function(){var e=document.createElement("img");e.width=30;e.height=30;e.src="https://raw.githubusercontent.com/MrInanimated/bp-overlay/master/dist/dragOn.png";bpOverlayImgs.dragOn=e;var t=document.createElement("img");t.width=30;t.height=30;t.src="https://raw.githubusercontent.com/MrInanimated/bp-overlay/master/dist/dragOff.png";bpOverlayImgs.dragOff=t;var n=document.createElement("BUTTON");var r=document.createElement("DIV");r.className="headerButtonDiv";var i=document.getElementsByTagName("header")[0];var s=i.lastChild;i.insertBefore(r,s);n.id="dragButton";n.className="headerButton";n.title="Have the info be in a draggable container instead";n.onclick=function(){if(bpOverlay.boxHasBeenCreated||bpOverlay.dragBoxHasBeenCreated){bpOverlay.dragonDrop=!bpOverlay.dragonDrop;if(bpOverlay.dragonDrop){var e=document.getElementById("Sidebar");var t=document.getElementById("infoBox");var r=document.getElementById("dragonDrop");e.removeChild(t);r.appendChild(t);n.removeChild(bpOverlayImgs.dragOff);n.appendChild(bpOverlayImgs.dragOn);bpOverlay.dragBoxHasBeenCreated=true;bpOverlay.boxHasBeenCreated=false}else{var e=document.getElementById("Sidebar");var t=document.getElementById("infoBox");var r=document.getElementById("dragonDrop");r.removeChild(t);e.insertBefore(t,e.firstChild);bpOverlay.dragBoxHasBeenCreated=false;bpOverlay.boxHasBeenCreated=true;n.removeChild(bpOverlayImgs.dragOn);n.appendChild(bpOverlayImgs.dragOff)}}else{alert("Didn't find the infoBox.\n\nIf you're running this for the first time and the round hasn't started or if it's the same player's turn from when you started the overlay then this is normal.\n\nYou impatient flap :D")}};n.appendChild(bpOverlayImgs.dragOff);r.appendChild(n)};var l=function(){if(channel.data.state==="playing"&&(bpOverlay.boxHasBeenCreated||bpOverlay.dragBoxHasBeenCreated)){var e=new Date;var t=Math.floor((e.getTime()-bpOverlay.startTime)/1e3);if(t%60<10){var n="0"}else{var n=""}bpOverlay.timeText="Elapsed time | "+Math.floor(t/60)+":"+n+""+t%60+"";document.getElementById("infoBoxTimer").textContent=bpOverlay.timeText}};var c=function(){var e=channel.appendToChat;channel.appendToChat=function(t,n){try{n=Autolinker.link(n,{className:"chatMessageLink"});if(bpOverlay.autoScroll){var r=document.getElementById("ChatLog");r.scrollTop=r.scrollHeight}}finally{e(t,n)}};var t=channel.socket.listeners("setActivePlayerIndex").shift();channel.socket.on("setActivePlayerIndex",function(e){try{if(bpOverlay.firstRun){o();bpOverlay.firstRun=false}if(bpOverlay.autoFocus){if(channel.data.actors[e].authId===window.app.user.authId){bpOverlay.focusNext=true}else if(bpOverlay.focusNext){document.getElementById("ChatInputBox").focus();bpOverlay.focusNext=false}}}finally{t(e)}});var n=channel.socket.listeners("winWord").shift();channel.socket.on("winWord",function(e){try{var t=channel.data.actorsByAuthId[e.playerAuthId];var r=bpOverlay.playerAuthId[e.playerAuthId];var s=t.lockedLetters.slice();var o=t.lastWord.toLowerCase();for(i=0;i<o.length;i++){var u;if((u=s.indexOf(o[i]))!=-1){s.splice(u,1)}}var a=s.length===0;if(a){bpOverlay.flips[r]+=1;if(bpOverlay.boxHasBeenCreated||bpOverlay.dragBoxHasBeenCreated){document.getElementById(r+" flips").textContent=bpOverlay.flips[r]}if(t.lives===3){bpOverlay.uFlips[r]+=1;if(bpOverlay.boxHasBeenCreated||bpOverlay.dragBoxHasBeenCreated){document.getElementById(r+" uFlips").textContent=bpOverlay.uFlips[r]}}}bpOverlay.wordCount+=1;if(bpOverlay.boxHasBeenCreated||bpOverlay.dragBoxHasBeenCreated){document.getElementById("infoWordCounter").textContent="Word Count: "+bpOverlay.wordCount}}finally{n(e)}});var r=channel.socket.listeners("setPlayerLives").shift();channel.socket.on("setPlayerLives",function(e){try{var t=channel.data.actorsByAuthId[e.playerAuthId];var n=bpOverlay.playerAuthId[e.playerAuthId];if(t.lives>e.lives){bpOverlay.lostLives[n]+=1;if(bpOverlay.boxHasBeenCreated||bpOverlay.dragBoxHasBeenCreated){document.getElementById(n+" lives").textContent=bpOverlay.lostLives[n]}}}finally{r(e)}});var s=channel.socket.listeners("setPlayerState").shift();channel.socket.on("setPlayerState",function(e){try{if(bpOverlay.boxHasBeenCreated||bpOverlay.dragBoxHasBeenCreated){if(e.state=="dead"){var t=bpOverlay.playerAuthId[e.playerAuthId];var n=document.getElementById(t+" row");n.style.color="#666";if(bpOverlay.hideDead){n.style.display="none"}}}}finally{s(e)}});var u=channel.socket.listeners("endGame").shift();channel.socket.on("endGame",function(e){try{bpOverlay.firstRun=true;if(bpOverlay.autoFocus){if(bpOverlay.focusNext){document.getElementById("ChatInputBox").focus();bpOverlay.focusNext=false}}l()}finally{u(e)}});var a=function(){var e=document.getElementsByClassName("ChannelUsers")[0];var t="Players:";for(var n in channel.data.users){t+="\n"+channel.data.users[n].displayName}e.title=t};channel.socket.on("addUser",a);channel.socket.on("removeUser",a);a()};var h=function(){var e=document.createElement("style");e.appendChild(document.createTextNode('.headerButtonDiv {  display: -webkit-box;  display: -moz-box;  display: -webkit-flex;  display: -ms-flexbox;  display: box;  display: flex;  opacity: 0.3;  -ms-filter: "progid:DXImageTransform.Microsoft.Alpha(Opacity=30)";  filter: alpha(opacity=30);} .headerButtonDiv:hover {  opacity: 1;  -ms-filter: none;  filter: none;} button.headerButton {  border: none;  background: none;  cursor: pointer;  opacity: 0.5;  -ms-filter: "progid:DXImageTransform.Microsoft.Alpha(Opacity=50)";  filter: alpha(opacity=50);  display: -webkit-box;  display: -moz-box;  display: -webkit-flex;  display: -ms-flexbox;  display: box;  display: flex;} button.headerButton:hover {  opacity: 0.8;  -ms-filter: "progid:DXImageTransform.Microsoft.Alpha(Opacity=80)";  filter: alpha(opacity=80);} button.headerButton:active {  opacity: 1;  -ms-filter: none;  filter: none;} .infoTableDiv::-webkit-scrollbar { width: 15px; height: 15px; } .infoTableDiv::-webkit-scrollbar-button { height: 0px; width: 0px; } .infoTableDiv::-webkit-scrollbar-track { background-color: rgba(0,0,0,0.05); } .infoTableDiv::-webkit-scrollbar-thumb { background-color: rgba(255,255,255,0.1); border: 3px solid transparent; -webkit-border-radius: 6px; border-radius: 6px; -webkit-background-clip: content; -moz-background-clip: content; background-clip: content-box; } .infoTableDiv::-webkit-scrollbar-thumb:hover { background-color: rgba(255,255,255,0.15); } .infoTableDiv::-webkit-scrollbar-corner { background-color: rgba(255,255,255,0.1); }'));document.getElementsByTagName("head")[0].appendChild(e);var t=document.createElement("img");t.width=15;t.height=15;t.src="https://raw.githubusercontent.com/MrInanimated/bp-overlay/master/dist/hideDeadOn.png";bpOverlayImgs.hideDeadOn=t;var n=document.createElement("img");n.width=15;n.height=15;n.src="https://raw.githubusercontent.com/MrInanimated/bp-overlay/master/dist/hideDeadOff.png";bpOverlayImgs.hideDeadOff=n;c();u();a();f()};h();setInterval(l,1e3);channel.appendToChat("Info","New Update! (2014-12-04):You can now switch between a drag vs docked mode by clicking the drag icon.")};e()}};var s=document.createElement("script");s.setAttribute("type","application/javascript");s.textContent="("+source+")();";document.body.appendChild(s);document.body.removeChild(s)